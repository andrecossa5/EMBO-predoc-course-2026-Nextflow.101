// Nextflow configuration for Pipeline 3

// Manifest
manifest {
    name            = 'pipeline-3-advanced'
    author          = 'EMBO Course 2026'
    homePage        = 'https://github.com/embo/nextflow-course'
    description     = 'Advanced scRNA-seq pipeline with parameter grids'
    mainScript      = 'main.nf'
    nextflowVersion = '>=1.0'
    version         = '1.0.0'
}

// Default parameters
params {
    manifest = "$baseDir/data/manifest.csv"
    outdir = "results"
    help = false
    
    // Exercise 1: Single-value parameters
    // Basic preprocessing parameters
    target_sum = 1e4
    min_umis = 500
    max_umis = 50000
    min_genes = 250
    max_genes = 7500
    max_percent_mt = 15.0
    gene_threshold = 0.01
    n_bins = 20
    metric = 'euclidean'
    n_neighbors = 15
    n_pcs = 30,
    n_hvgs = 2000
    resolution = 1.0
    
    // Exercise 2: Multi-value parameters for hyperparameter grid
    // n_neighbors = [10, 15, 20, 30]
    // n_pcs = [20, 30, 40, 50]
    // n_hvgs = [1000, 2000, 3000, 4000]
    // resolution = [0.1, 0.3, 0.5, 0.8, 1.0]
}

// Process execution configuration
process {
    // Default settings
    cpus = 2
    memory = '8 GB'
    time = '4h'
    
    // Process-specific settings
    withName: 'PP' {
        cpus = 4
        memory = '16 GB'
        time = '6h'
        
        // Python environment requirements
        // TODO: Add conda/docker environment specifications
    }
    
    withName: 'CONCATENATE' {
        cpus = 2
        memory = '32 GB'  // Higher memory for concatenating multiple samples
        time = '4h'
        
        // Python environment requirements
        // TODO: Add conda/docker environment specifications  
    }
}

// Execution profiles
profiles {
    standard {
        process.executor = 'local'
    }
    
    cluster {
        process.executor = 'slurm'
        process.queue = 'cpu'
    }
    
    docker {
        docker.enabled = true
        process.container = 'scanpy/scanpy:latest'
    }
    
    singularity {
        singularity.enabled = true
        process.container = 'docker://scanpy/scanpy:latest'
    }
}

// Resource management
executor {
    queueSize = 20
    submitRateLimit = '1 sec'
}

// Reporting and monitoring
timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
}